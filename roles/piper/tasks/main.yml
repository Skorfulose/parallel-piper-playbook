- name: Install prerequisites
  package:
    name: "{{ item }}"
    state: latest
  with_items:
    - npm
    - nodejs-legacy
  become: true

- name: Create /src directory
  file:
    path: /src
    state: directory
    mode: 0777
  become: true

- name: Clone repository
  git:
    repo: 'https://github.com/Skorfulose/parallel-piper.git'
    dest: /src/parallel-piper
    force: yes

- name: Install node dependencies
  command: npm install
  args:
    chdir: /src/parallel-piper/

- name: Run webpack build
  command: sh build.sh
  args:
    chdir: /src/parallel-piper/
